version: '3.0'

expectations:

  population_size: 100000

actions:

  ## # # # # # # # # # # # # # # # # # # # 
  ## DO NOT EDIT project.yaml DIRECTLY 
  ## This file is created by create-project.R 
  ## Edit and run create-project.R to update the project.yaml 
  ## # # # # # # # # # # # # # # # # # # # 
  ##   
  ## # # # # # # # # # # # # # # # # # # # 
  ## Preliminaries 
  ## # # # # # # # # # # # # # # # # # # # 

  design:
    run: r:latest analysis/design.R
    outputs:
      moderately_sensitive:
        lib: lib/design/study-dates.json

  ## # # # # # # # # # # # # # # # # # # # 
  ## Extract and process treated data 
  ## # # # # # # # # # # # # # # # # # # # 

  extract_treated:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_treated
      --output-file output/treated/extract/input_treated.feather
    needs:
    - design
    outputs:
      highly_sensitive:
        extract: output/treated/extract/input_treated.feather

  process_treated:
    run: r:latest analysis/process_data.R treated
    needs:
    - extract_treated
    outputs:
      highly_sensitive:
        eligiblerds: output/treated/eligible/*.rds
        pfizer: output/pfizer/treated/*.rds
        moderna: output/moderna/treated/*.rds
      moderately_sensitive:
        eligiblecsv: output/treated/eligible/*.csv
        input_treated_skim: output/treated/extract/*.txt
        data_processed_skim: output/treated/process/*.txt
        data_eligible_skim: output/treated/eligible/*.txt

  ## # # # # # # # # # # # # # # # # # # # 
  ## mrna cohort 
  ## # # # # # # # # # # # # # # # # # # # 
  ## # # # # # # # # # # # # # # # # # # # 
  ## Extract and match 

  extract_controlpotential_mrna_1:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_controlpotential
      --output-file output/mrna/matchround1/extract/input_controlpotential.feather
      --param cohort=mrna --param matching_round=1 --param index_date=2021-09-16
    needs:
    - design
    outputs:
      highly_sensitive:
        cohort: output/mrna/matchround1/extract/input_controlpotential.feather

  process_controlpotential_mrna_1:
    run: r:latest analysis/process_data.R potential mrna 1
    needs:
    - extract_controlpotential_mrna_1
    outputs:
      highly_sensitive:
        rds: output/mrna/matchround1/process/*.rds
      moderately_sensitive:
        input_controlpotential_skim: output/mrna/matchround1/extract/potential/*.txt
        data_processed_skim: output/mrna/matchround1/potential/*.txt
        data_controlpotential_skim: output/mrna/matchround1/process/*.txt

  match_potential_mrna_1:
    run: r:latest analysis/matching/match_potential.R mrna 1
    needs:
    - process_treated
    - process_controlpotential_mrna_1
    outputs:
      highly_sensitive:
        rds: output/mrna/matchround1/potential/*.rds
        csv: output/mrna/matchround1/potential/*.csv.gz

  extract_controlactual_mrna_1:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_controlactual
      --output-file output/mrna/matchround1/extract/input_controlactual.feather --param
      cohort=mrna --param matching_round=1
    needs:
    - design
    - match_potential_mrna_1
    outputs:
      highly_sensitive:
        cohort: output/mrna/matchround1/extract/input_controlactual.feather

  process_controlactual_mrna_1:
    run: r:latest analysis/process_data.R actual mrna 1
    needs:
    - process_treated
    - match_potential_mrna_1
    - extract_controlpotential_mrna_1
    - process_controlpotential_mrna_1
    - extract_controlactual_mrna_1
    outputs:
      highly_sensitive:
        rds: output/mrna/matchround1/actual/*.rds
        csv: output/mrna/matchround1/actual/*.csv.gz
      moderately_sensitive:
        input_controlactual_skim: output/mrna/matchround1/extract/actual/*.txt
        data_actual_skim: output/mrna/matchround1/actual/*.txt

  extract_controlpotential_mrna_2:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_controlpotential
      --output-file output/mrna/matchround2/extract/input_controlpotential.feather
      --param cohort=mrna --param matching_round=2 --param index_date=2021-09-30
    needs:
    - design
    - process_controlactual_mrna_1
    outputs:
      highly_sensitive:
        cohort: output/mrna/matchround2/extract/input_controlpotential.feather

  process_controlpotential_mrna_2:
    run: r:latest analysis/process_data.R potential mrna 2
    needs:
    - extract_controlpotential_mrna_2
    outputs:
      highly_sensitive:
        rds: output/mrna/matchround2/process/*.rds
      moderately_sensitive:
        input_controlpotential_skim: output/mrna/matchround2/extract/potential/*.txt
        data_processed_skim: output/mrna/matchround2/potential/*.txt
        data_controlpotential_skim: output/mrna/matchround2/process/*.txt

  match_potential_mrna_2:
    run: r:latest analysis/matching/match_potential.R mrna 2
    needs:
    - process_treated
    - process_controlpotential_mrna_2
    - process_controlactual_mrna_1
    outputs:
      highly_sensitive:
        rds: output/mrna/matchround2/potential/*.rds
        csv: output/mrna/matchround2/potential/*.csv.gz

  extract_controlactual_mrna_2:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_controlactual
      --output-file output/mrna/matchround2/extract/input_controlactual.feather --param
      cohort=mrna --param matching_round=2
    needs:
    - design
    - match_potential_mrna_2
    outputs:
      highly_sensitive:
        cohort: output/mrna/matchround2/extract/input_controlactual.feather

  process_controlactual_mrna_2:
    run: r:latest analysis/process_data.R actual mrna 2
    needs:
    - process_treated
    - match_potential_mrna_2
    - extract_controlpotential_mrna_2
    - process_controlpotential_mrna_2
    - extract_controlactual_mrna_2
    - process_controlactual_mrna_1
    outputs:
      highly_sensitive:
        rds: output/mrna/matchround2/actual/*.rds
        csv: output/mrna/matchround2/actual/*.csv.gz
      moderately_sensitive:
        input_controlactual_skim: output/mrna/matchround2/extract/actual/*.txt
        data_actual_skim: output/mrna/matchround2/actual/*.txt

  extract_controlfinal_mrna:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_controlfinal
      --output-file output/mrna/extract/input_controlfinal.feather --param cohort=mrna
      --param n_matching_rounds=2
    needs:
    - design
    - process_controlactual_mrna_2
    outputs:
      highly_sensitive:
        extract: output/mrna/extract/input_controlfinal.feather

  dummydata_controlfinal_mrna:
    run: r:latest analysis/dummy/dummydata_controlfinal.R mrna
    needs:
    - process_controlactual_mrna_1
    - process_controlactual_mrna_2
    outputs:
      highly_sensitive:
        dummydata_controlfinal: output/mrna/dummydata/dummy_control_final.feather

  process_controlfinal_mrna:
    run: r:latest analysis/process_data.R final mrna
    needs:
    - process_controlactual_mrna_1
    - process_controlactual_mrna_2
    - extract_controlfinal_mrna
    - process_treated
    - dummydata_controlfinal_mrna
    outputs:
      highly_sensitive:
        extract: output/mrna/match/*.rds
        ids: output/mrna/match/*.csv.gz
      moderately_sensitive:
        input_controlfinal_skim: output/mrna/extract/*.txt
        data_matched_skim: output/mrna/match/*.txt

  table1_mrna:
    run: r:latest analysis/matching/table1.R mrna
    needs:
    - process_controlfinal_mrna
    outputs:
      moderately_sensitive:
        csv: output/mrna/table1/*.csv
        html: output/mrna/table1/*.html

  coverage_mrna:
    run: r:latest analysis/matching/coverage.R mrna
    needs:
    - process_controlfinal_mrna
    outputs:
      moderately_sensitive:
        csv: output/mrna/match/coverage/*.csv
        png: output/mrna/match/coverage/*.png

  ## # # # # # # # # # # # # # # # # # # # 
  ## Covid tests data 
  ## # # # # # # # # # # # # # # # # # # # 

  extract_covidtests_mrna:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_covidtests
      --output-file output/mrna/covidtests/extract/input_covidtests.feather --param
      cohort=mrna
    needs:
    - design
    - process_controlfinal_mrna
    outputs:
      highly_sensitive:
        extract: output/mrna/covidtests/extract/input_covidtests.feather

  process_covidtests_mrna:
    run: r:latest analysis/covidtests/process_covidtests.R mrna
    needs:
    - process_controlfinal_mrna
    - extract_covidtests_mrna
    outputs:
      highly_sensitive:
        extract: output/mrna/covidtests/process/*.rds
      moderately_sensitive:
        skim: output/mrna/covidtests/extract/*.txt
        png: output/mrna/covidtests/checks/*.png

  ## # # # # # # # # # # # # # # # # # # # 
  ## Model 
  ## # # # # # # # # # # # # # # # # # # # 

  cinc_dose4_mrna:
    run: r:latest analysis/model/cinc_dose4.R mrna
    needs:
    - process_controlfinal_mrna
    outputs:
      moderately_sensitive:
        csv: output/mrna/models/cinc_dose4/*.csv
        png: output/mrna/models/cinc_dose4/*.png

  ## # # # # # # # # # # # # # # # # # # # # # # # # # # #  
  ## cohort: mrna; subgroup: all; variant option: ignore 
  ## # # # # # # # # # # # # # # # # # # # # # # # # # # #  

  km_mrna_all_ignore_postest:
    run: r:latest analysis/model/km.R mrna all ignore postest
    needs:
    - process_controlfinal_mrna
    outputs:
      moderately_sensitive:
        rds: output/mrna/models/km/all/ignore/postest/*.rds
        png: output/mrna/models/km/all/ignore/postest/*.png

  km_mrna_all_ignore_covidadmitted:
    run: r:latest analysis/model/km.R mrna all ignore covidadmitted
    needs:
    - process_controlfinal_mrna
    outputs:
      moderately_sensitive:
        rds: output/mrna/models/km/all/ignore/covidadmitted/*.rds
        png: output/mrna/models/km/all/ignore/covidadmitted/*.png

  km_mrna_all_ignore_covidcritcareordeath:
    run: r:latest analysis/model/km.R mrna all ignore covidcritcareordeath
    needs:
    - process_controlfinal_mrna
    outputs:
      moderately_sensitive:
        rds: output/mrna/models/km/all/ignore/covidcritcareordeath/*.rds
        png: output/mrna/models/km/all/ignore/covidcritcareordeath/*.png

  km_mrna_all_ignore_coviddeath:
    run: r:latest analysis/model/km.R mrna all ignore coviddeath
    needs:
    - process_controlfinal_mrna
    outputs:
      moderately_sensitive:
        rds: output/mrna/models/km/all/ignore/coviddeath/*.rds
        png: output/mrna/models/km/all/ignore/coviddeath/*.png

  km_mrna_all_ignore_emergency:
    run: r:latest analysis/model/km.R mrna all ignore emergency
    needs:
    - process_controlfinal_mrna
    outputs:
      moderately_sensitive:
        rds: output/mrna/models/km/all/ignore/emergency/*.rds
        png: output/mrna/models/km/all/ignore/emergency/*.png

  km_mrna_all_ignore_covidemergency:
    run: r:latest analysis/model/km.R mrna all ignore covidemergency
    needs:
    - process_controlfinal_mrna
    outputs:
      moderately_sensitive:
        rds: output/mrna/models/km/all/ignore/covidemergency/*.rds
        png: output/mrna/models/km/all/ignore/covidemergency/*.png

  km_mrna_all_ignore_noncoviddeath:
    run: r:latest analysis/model/km.R mrna all ignore noncoviddeath
    needs:
    - process_controlfinal_mrna
    outputs:
      moderately_sensitive:
        rds: output/mrna/models/km/all/ignore/noncoviddeath/*.rds
        png: output/mrna/models/km/all/ignore/noncoviddeath/*.png

  ## # # # # # # # # # # # # # # # # # # # # # # # # # # #  
  ## cohort: mrna; subgroup: all; variant option: split 
  ## # # # # # # # # # # # # # # # # # # # # # # # # # # #  

  km_mrna_all_split_postest:
    run: r:latest analysis/model/km.R mrna all split postest
    needs:
    - process_controlfinal_mrna
    outputs:
      moderately_sensitive:
        rds: output/mrna/models/km/all/split/postest/*.rds
        png: output/mrna/models/km/all/split/postest/*.png

  km_mrna_all_split_covidadmitted:
    run: r:latest analysis/model/km.R mrna all split covidadmitted
    needs:
    - process_controlfinal_mrna
    outputs:
      moderately_sensitive:
        rds: output/mrna/models/km/all/split/covidadmitted/*.rds
        png: output/mrna/models/km/all/split/covidadmitted/*.png

  km_mrna_all_split_covidcritcareordeath:
    run: r:latest analysis/model/km.R mrna all split covidcritcareordeath
    needs:
    - process_controlfinal_mrna
    outputs:
      moderately_sensitive:
        rds: output/mrna/models/km/all/split/covidcritcareordeath/*.rds
        png: output/mrna/models/km/all/split/covidcritcareordeath/*.png

  km_mrna_all_split_coviddeath:
    run: r:latest analysis/model/km.R mrna all split coviddeath
    needs:
    - process_controlfinal_mrna
    outputs:
      moderately_sensitive:
        rds: output/mrna/models/km/all/split/coviddeath/*.rds
        png: output/mrna/models/km/all/split/coviddeath/*.png

  km_mrna_all_split_emergency:
    run: r:latest analysis/model/km.R mrna all split emergency
    needs:
    - process_controlfinal_mrna
    outputs:
      moderately_sensitive:
        rds: output/mrna/models/km/all/split/emergency/*.rds
        png: output/mrna/models/km/all/split/emergency/*.png

  km_mrna_all_split_covidemergency:
    run: r:latest analysis/model/km.R mrna all split covidemergency
    needs:
    - process_controlfinal_mrna
    outputs:
      moderately_sensitive:
        rds: output/mrna/models/km/all/split/covidemergency/*.rds
        png: output/mrna/models/km/all/split/covidemergency/*.png

  km_mrna_all_split_noncoviddeath:
    run: r:latest analysis/model/km.R mrna all split noncoviddeath
    needs:
    - process_controlfinal_mrna
    outputs:
      moderately_sensitive:
        rds: output/mrna/models/km/all/split/noncoviddeath/*.rds
        png: output/mrna/models/km/all/split/noncoviddeath/*.png

  ## # # # # # # # # # # # # # # # # # # # # # # # # # # #  
  ## cohort: mrna; subgroup: all; variant option: restrict 
  ## # # # # # # # # # # # # # # # # # # # # # # # # # # #  

  km_mrna_all_restrict_postest:
    run: r:latest analysis/model/km.R mrna all restrict postest
    needs:
    - process_controlfinal_mrna
    outputs:
      moderately_sensitive:
        rds: output/mrna/models/km/all/restrict/postest/*.rds
        png: output/mrna/models/km/all/restrict/postest/*.png

  km_mrna_all_restrict_covidadmitted:
    run: r:latest analysis/model/km.R mrna all restrict covidadmitted
    needs:
    - process_controlfinal_mrna
    outputs:
      moderately_sensitive:
        rds: output/mrna/models/km/all/restrict/covidadmitted/*.rds
        png: output/mrna/models/km/all/restrict/covidadmitted/*.png

  km_mrna_all_restrict_covidcritcareordeath:
    run: r:latest analysis/model/km.R mrna all restrict covidcritcareordeath
    needs:
    - process_controlfinal_mrna
    outputs:
      moderately_sensitive:
        rds: output/mrna/models/km/all/restrict/covidcritcareordeath/*.rds
        png: output/mrna/models/km/all/restrict/covidcritcareordeath/*.png

  km_mrna_all_restrict_coviddeath:
    run: r:latest analysis/model/km.R mrna all restrict coviddeath
    needs:
    - process_controlfinal_mrna
    outputs:
      moderately_sensitive:
        rds: output/mrna/models/km/all/restrict/coviddeath/*.rds
        png: output/mrna/models/km/all/restrict/coviddeath/*.png

  km_mrna_all_restrict_emergency:
    run: r:latest analysis/model/km.R mrna all restrict emergency
    needs:
    - process_controlfinal_mrna
    outputs:
      moderately_sensitive:
        rds: output/mrna/models/km/all/restrict/emergency/*.rds
        png: output/mrna/models/km/all/restrict/emergency/*.png

  km_mrna_all_restrict_covidemergency:
    run: r:latest analysis/model/km.R mrna all restrict covidemergency
    needs:
    - process_controlfinal_mrna
    outputs:
      moderately_sensitive:
        rds: output/mrna/models/km/all/restrict/covidemergency/*.rds
        png: output/mrna/models/km/all/restrict/covidemergency/*.png

  km_mrna_all_restrict_noncoviddeath:
    run: r:latest analysis/model/km.R mrna all restrict noncoviddeath
    needs:
    - process_controlfinal_mrna
    outputs:
      moderately_sensitive:
        rds: output/mrna/models/km/all/restrict/noncoviddeath/*.rds
        png: output/mrna/models/km/all/restrict/noncoviddeath/*.png

  ## # # # # # # # # # # # # # # # # # # # # # # # # # # #  
  ## cohort: mrna; subgroup: vax3_type; variant option: ignore 
  ## # # # # # # # # # # # # # # # # # # # # # # # # # # #  

  km_mrna_vax3_type_ignore_postest:
    run: r:latest analysis/model/km.R mrna vax3_type ignore postest
    needs:
    - process_controlfinal_mrna
    outputs:
      moderately_sensitive:
        rds: output/mrna/models/km/vax3_type/ignore/postest/*.rds
        png: output/mrna/models/km/vax3_type/ignore/postest/*.png

  km_mrna_vax3_type_ignore_covidadmitted:
    run: r:latest analysis/model/km.R mrna vax3_type ignore covidadmitted
    needs:
    - process_controlfinal_mrna
    outputs:
      moderately_sensitive:
        rds: output/mrna/models/km/vax3_type/ignore/covidadmitted/*.rds
        png: output/mrna/models/km/vax3_type/ignore/covidadmitted/*.png

  km_mrna_vax3_type_ignore_covidcritcareordeath:
    run: r:latest analysis/model/km.R mrna vax3_type ignore covidcritcareordeath
    needs:
    - process_controlfinal_mrna
    outputs:
      moderately_sensitive:
        rds: output/mrna/models/km/vax3_type/ignore/covidcritcareordeath/*.rds
        png: output/mrna/models/km/vax3_type/ignore/covidcritcareordeath/*.png

  km_mrna_vax3_type_ignore_coviddeath:
    run: r:latest analysis/model/km.R mrna vax3_type ignore coviddeath
    needs:
    - process_controlfinal_mrna
    outputs:
      moderately_sensitive:
        rds: output/mrna/models/km/vax3_type/ignore/coviddeath/*.rds
        png: output/mrna/models/km/vax3_type/ignore/coviddeath/*.png

  km_mrna_vax3_type_ignore_emergency:
    run: r:latest analysis/model/km.R mrna vax3_type ignore emergency
    needs:
    - process_controlfinal_mrna
    outputs:
      moderately_sensitive:
        rds: output/mrna/models/km/vax3_type/ignore/emergency/*.rds
        png: output/mrna/models/km/vax3_type/ignore/emergency/*.png

  km_mrna_vax3_type_ignore_covidemergency:
    run: r:latest analysis/model/km.R mrna vax3_type ignore covidemergency
    needs:
    - process_controlfinal_mrna
    outputs:
      moderately_sensitive:
        rds: output/mrna/models/km/vax3_type/ignore/covidemergency/*.rds
        png: output/mrna/models/km/vax3_type/ignore/covidemergency/*.png

  km_mrna_vax3_type_ignore_noncoviddeath:
    run: r:latest analysis/model/km.R mrna vax3_type ignore noncoviddeath
    needs:
    - process_controlfinal_mrna
    outputs:
      moderately_sensitive:
        rds: output/mrna/models/km/vax3_type/ignore/noncoviddeath/*.rds
        png: output/mrna/models/km/vax3_type/ignore/noncoviddeath/*.png

  ## # # # # # # # # # # # # # # # # # # # # # # # # # # #  
  ## cohort: mrna; subgroup: prior_covid_infection; variant option: ignore 
  ## # # # # # # # # # # # # # # # # # # # # # # # # # # #  

  km_mrna_prior_covid_infection_ignore_postest:
    run: r:latest analysis/model/km.R mrna prior_covid_infection ignore postest
    needs:
    - process_controlfinal_mrna
    outputs:
      moderately_sensitive:
        rds: output/mrna/models/km/prior_covid_infection/ignore/postest/*.rds
        png: output/mrna/models/km/prior_covid_infection/ignore/postest/*.png

  km_mrna_prior_covid_infection_ignore_covidadmitted:
    run: r:latest analysis/model/km.R mrna prior_covid_infection ignore covidadmitted
    needs:
    - process_controlfinal_mrna
    outputs:
      moderately_sensitive:
        rds: output/mrna/models/km/prior_covid_infection/ignore/covidadmitted/*.rds
        png: output/mrna/models/km/prior_covid_infection/ignore/covidadmitted/*.png

  km_mrna_prior_covid_infection_ignore_covidcritcareordeath:
    run: r:latest analysis/model/km.R mrna prior_covid_infection ignore covidcritcareordeath
    needs:
    - process_controlfinal_mrna
    outputs:
      moderately_sensitive:
        rds: output/mrna/models/km/prior_covid_infection/ignore/covidcritcareordeath/*.rds
        png: output/mrna/models/km/prior_covid_infection/ignore/covidcritcareordeath/*.png

  km_mrna_prior_covid_infection_ignore_coviddeath:
    run: r:latest analysis/model/km.R mrna prior_covid_infection ignore coviddeath
    needs:
    - process_controlfinal_mrna
    outputs:
      moderately_sensitive:
        rds: output/mrna/models/km/prior_covid_infection/ignore/coviddeath/*.rds
        png: output/mrna/models/km/prior_covid_infection/ignore/coviddeath/*.png

  km_mrna_prior_covid_infection_ignore_emergency:
    run: r:latest analysis/model/km.R mrna prior_covid_infection ignore emergency
    needs:
    - process_controlfinal_mrna
    outputs:
      moderately_sensitive:
        rds: output/mrna/models/km/prior_covid_infection/ignore/emergency/*.rds
        png: output/mrna/models/km/prior_covid_infection/ignore/emergency/*.png

  km_mrna_prior_covid_infection_ignore_covidemergency:
    run: r:latest analysis/model/km.R mrna prior_covid_infection ignore covidemergency
    needs:
    - process_controlfinal_mrna
    outputs:
      moderately_sensitive:
        rds: output/mrna/models/km/prior_covid_infection/ignore/covidemergency/*.rds
        png: output/mrna/models/km/prior_covid_infection/ignore/covidemergency/*.png

  km_mrna_prior_covid_infection_ignore_noncoviddeath:
    run: r:latest analysis/model/km.R mrna prior_covid_infection ignore noncoviddeath
    needs:
    - process_controlfinal_mrna
    outputs:
      moderately_sensitive:
        rds: output/mrna/models/km/prior_covid_infection/ignore/noncoviddeath/*.rds
        png: output/mrna/models/km/prior_covid_infection/ignore/noncoviddeath/*.png

  ## # # # # # # # # # # # # # # # # # # # # # # # # # # #  
  ## cohort: mrna; subgroup: vax12_type; variant option: ignore 
  ## # # # # # # # # # # # # # # # # # # # # # # # # # # #  

  km_mrna_vax12_type_ignore_postest:
    run: r:latest analysis/model/km.R mrna vax12_type ignore postest
    needs:
    - process_controlfinal_mrna
    outputs:
      moderately_sensitive:
        rds: output/mrna/models/km/vax12_type/ignore/postest/*.rds
        png: output/mrna/models/km/vax12_type/ignore/postest/*.png

  km_mrna_vax12_type_ignore_covidadmitted:
    run: r:latest analysis/model/km.R mrna vax12_type ignore covidadmitted
    needs:
    - process_controlfinal_mrna
    outputs:
      moderately_sensitive:
        rds: output/mrna/models/km/vax12_type/ignore/covidadmitted/*.rds
        png: output/mrna/models/km/vax12_type/ignore/covidadmitted/*.png

  km_mrna_vax12_type_ignore_covidcritcareordeath:
    run: r:latest analysis/model/km.R mrna vax12_type ignore covidcritcareordeath
    needs:
    - process_controlfinal_mrna
    outputs:
      moderately_sensitive:
        rds: output/mrna/models/km/vax12_type/ignore/covidcritcareordeath/*.rds
        png: output/mrna/models/km/vax12_type/ignore/covidcritcareordeath/*.png

  km_mrna_vax12_type_ignore_coviddeath:
    run: r:latest analysis/model/km.R mrna vax12_type ignore coviddeath
    needs:
    - process_controlfinal_mrna
    outputs:
      moderately_sensitive:
        rds: output/mrna/models/km/vax12_type/ignore/coviddeath/*.rds
        png: output/mrna/models/km/vax12_type/ignore/coviddeath/*.png

  km_mrna_vax12_type_ignore_emergency:
    run: r:latest analysis/model/km.R mrna vax12_type ignore emergency
    needs:
    - process_controlfinal_mrna
    outputs:
      moderately_sensitive:
        rds: output/mrna/models/km/vax12_type/ignore/emergency/*.rds
        png: output/mrna/models/km/vax12_type/ignore/emergency/*.png

  km_mrna_vax12_type_ignore_covidemergency:
    run: r:latest analysis/model/km.R mrna vax12_type ignore covidemergency
    needs:
    - process_controlfinal_mrna
    outputs:
      moderately_sensitive:
        rds: output/mrna/models/km/vax12_type/ignore/covidemergency/*.rds
        png: output/mrna/models/km/vax12_type/ignore/covidemergency/*.png

  km_mrna_vax12_type_ignore_noncoviddeath:
    run: r:latest analysis/model/km.R mrna vax12_type ignore noncoviddeath
    needs:
    - process_controlfinal_mrna
    outputs:
      moderately_sensitive:
        rds: output/mrna/models/km/vax12_type/ignore/noncoviddeath/*.rds
        png: output/mrna/models/km/vax12_type/ignore/noncoviddeath/*.png

  ## # # # # # # # # # # # # # # # # # # # # # # # # # # #  
  ## cohort: mrna; subgroup: agegroup; variant option: ignore 
  ## # # # # # # # # # # # # # # # # # # # # # # # # # # #  

  km_mrna_agegroup_ignore_postest:
    run: r:latest analysis/model/km.R mrna agegroup ignore postest
    needs:
    - process_controlfinal_mrna
    outputs:
      moderately_sensitive:
        rds: output/mrna/models/km/agegroup/ignore/postest/*.rds
        png: output/mrna/models/km/agegroup/ignore/postest/*.png

  km_mrna_agegroup_ignore_covidadmitted:
    run: r:latest analysis/model/km.R mrna agegroup ignore covidadmitted
    needs:
    - process_controlfinal_mrna
    outputs:
      moderately_sensitive:
        rds: output/mrna/models/km/agegroup/ignore/covidadmitted/*.rds
        png: output/mrna/models/km/agegroup/ignore/covidadmitted/*.png

  km_mrna_agegroup_ignore_covidcritcareordeath:
    run: r:latest analysis/model/km.R mrna agegroup ignore covidcritcareordeath
    needs:
    - process_controlfinal_mrna
    outputs:
      moderately_sensitive:
        rds: output/mrna/models/km/agegroup/ignore/covidcritcareordeath/*.rds
        png: output/mrna/models/km/agegroup/ignore/covidcritcareordeath/*.png

  km_mrna_agegroup_ignore_coviddeath:
    run: r:latest analysis/model/km.R mrna agegroup ignore coviddeath
    needs:
    - process_controlfinal_mrna
    outputs:
      moderately_sensitive:
        rds: output/mrna/models/km/agegroup/ignore/coviddeath/*.rds
        png: output/mrna/models/km/agegroup/ignore/coviddeath/*.png

  km_mrna_agegroup_ignore_emergency:
    run: r:latest analysis/model/km.R mrna agegroup ignore emergency
    needs:
    - process_controlfinal_mrna
    outputs:
      moderately_sensitive:
        rds: output/mrna/models/km/agegroup/ignore/emergency/*.rds
        png: output/mrna/models/km/agegroup/ignore/emergency/*.png

  km_mrna_agegroup_ignore_covidemergency:
    run: r:latest analysis/model/km.R mrna agegroup ignore covidemergency
    needs:
    - process_controlfinal_mrna
    outputs:
      moderately_sensitive:
        rds: output/mrna/models/km/agegroup/ignore/covidemergency/*.rds
        png: output/mrna/models/km/agegroup/ignore/covidemergency/*.png

  km_mrna_agegroup_ignore_noncoviddeath:
    run: r:latest analysis/model/km.R mrna agegroup ignore noncoviddeath
    needs:
    - process_controlfinal_mrna
    outputs:
      moderately_sensitive:
        rds: output/mrna/models/km/agegroup/ignore/noncoviddeath/*.rds
        png: output/mrna/models/km/agegroup/ignore/noncoviddeath/*.png

  ## # # # # # # # # # # # # # # # # # # # 
  ## combine all outputs for mrna cohort 
  ## # # # # # # # # # # # # # # # # # # # 

  combine_km_mrna:
    run: r:latest analysis/model/km_combine.R mrna
    needs:
    - km_mrna_all_ignore_postest
    - km_mrna_all_split_postest
    - km_mrna_all_restrict_postest
    - km_mrna_all_ignore_covidadmitted
    - km_mrna_all_split_covidadmitted
    - km_mrna_all_restrict_covidadmitted
    - km_mrna_all_ignore_covidcritcareordeath
    - km_mrna_all_split_covidcritcareordeath
    - km_mrna_all_restrict_covidcritcareordeath
    - km_mrna_all_ignore_coviddeath
    - km_mrna_all_split_coviddeath
    - km_mrna_all_restrict_coviddeath
    - km_mrna_all_ignore_emergency
    - km_mrna_all_split_emergency
    - km_mrna_all_restrict_emergency
    - km_mrna_all_ignore_covidemergency
    - km_mrna_all_split_covidemergency
    - km_mrna_all_restrict_covidemergency
    - km_mrna_all_ignore_noncoviddeath
    - km_mrna_all_split_noncoviddeath
    - km_mrna_all_restrict_noncoviddeath
    - km_mrna_vax3_type_ignore_postest
    - km_mrna_vax3_type_ignore_covidadmitted
    - km_mrna_vax3_type_ignore_covidcritcareordeath
    - km_mrna_vax3_type_ignore_coviddeath
    - km_mrna_vax3_type_ignore_emergency
    - km_mrna_vax3_type_ignore_covidemergency
    - km_mrna_vax3_type_ignore_noncoviddeath
    - km_mrna_prior_covid_infection_ignore_postest
    - km_mrna_prior_covid_infection_ignore_covidadmitted
    - km_mrna_prior_covid_infection_ignore_covidcritcareordeath
    - km_mrna_prior_covid_infection_ignore_coviddeath
    - km_mrna_prior_covid_infection_ignore_emergency
    - km_mrna_prior_covid_infection_ignore_covidemergency
    - km_mrna_prior_covid_infection_ignore_noncoviddeath
    - km_mrna_vax12_type_ignore_postest
    - km_mrna_vax12_type_ignore_covidadmitted
    - km_mrna_vax12_type_ignore_covidcritcareordeath
    - km_mrna_vax12_type_ignore_coviddeath
    - km_mrna_vax12_type_ignore_emergency
    - km_mrna_vax12_type_ignore_covidemergency
    - km_mrna_vax12_type_ignore_noncoviddeath
    - km_mrna_agegroup_ignore_postest
    - km_mrna_agegroup_ignore_covidadmitted
    - km_mrna_agegroup_ignore_covidcritcareordeath
    - km_mrna_agegroup_ignore_coviddeath
    - km_mrna_agegroup_ignore_emergency
    - km_mrna_agegroup_ignore_covidemergency
    - km_mrna_agegroup_ignore_noncoviddeath
    outputs:
      moderately_sensitive:
        rds: output/mrna/models/km/combined/*.csv
        png: output/mrna/models/km/combined/*.png

  ## #### End #### 

